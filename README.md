# ファイル名一括リネーマー

## 環境構築

### 要件定義プロンプト

利用モデル: Claude Opus4.1

```
ファイルを一括でアップロードするとそのプレビューを表示するアプリケーションを作成します。
アップロードしたファイルは一括でリネームし、zip 形式でまとめてダウンロードできるツールです。
ソート順は、名前順や日付順に加えて、手動でドラッグ&ドロップして順番を入れ替えることできます。言語は日本語です。
このようなアプリケーションを作成するために必要な要件を定義してください。
```

### モック画面作成の指示取得プロンプト

利用モデル: Claude Opus4.1

```
上記の要件定義に従い、v0.dev でモック画面を作成します。
適切なプロンプトを出力してください。
```

### モック画面作成プロンプト

利用サービス: v0.dev

```
**日本語のファイル管理アプリケーションのUIを作成してください。**

## 主要機能

- ファイルの一括アップロード（ドラッグ&ドロップ対応）
- アップロードしたファイルのプレビュー表示（グリッド/リスト切替可能）
- ファイルの一括リネーム機能
- ドラッグ&ドロップでファイルの順番を手動で並び替え
- 選択したファイルをZIP形式でダウンロード

## UI要素

### ヘッダー

- アプリタイトル「ファイル管理ツール」
- 「ファイルを選択」ボタン（プライマリ）
- 「ZIPダウンロード」ボタン

### ツールバー

- 表示切替トグル（グリッド表示/リスト表示）
- ソート選択ドロップダウン（名前順、日付順、サイズ順、手動）
- 「全て選択」チェックボックス
- 「一括リネーム」ボタン
- 「選択を削除」ボタン

### メインエリア

- ドラッグ&ドロップ対応のアップロードエリア（ファイルがない時）
    - 「ここにファイルをドラッグ&ドロップ」のメッセージ
    - 点線の枠で囲まれたエリア
- ファイル一覧（グリッド表示）
    - 各ファイルカード：サムネイル/アイコン、ファイル名、サイズ、チェックボックス、削除ボタン
    - ドラッグ可能なインジケーター
- ファイル一覧（リスト表示）
    - テーブル形式：チェックボックス、サムネイル、名前、サイズ、更新日時、アクション

### サイドパネル（右側・開閉可能）

- 「リネーム設定」セクション
    - リネームパターン選択（連番、日付追加、プレフィックス/サフィックス）
    - プレビューエリア
    - 「適用」ボタン
- 「ファイル情報」セクション
    - 選択中のファイル詳細

### フッター

- 「3個のファイルを選択中」
- 「合計サイズ: 25.4 MB」
- 「全12ファイル」

## デザイン要件

- モダンでクリーンなデザイン（shadcn/ui使用）
- 日本語UI（ボタン、ラベル、メッセージ全て日本語）
- レスポンシブ対応
- ダークモード対応
- ドラッグ中の視覚的フィードバック
- ホバーエフェクト
- 画像ファイルは実際のサムネイル風のプレースホルダー
- 非画像ファイルは適切なファイルアイコン（PDF、TXT、ZIP等）

## サンプルデータ

- 画像ファイル数個（photo_001.jpg, image_002.png等）
- PDFファイル（document.pdf）
- テキストファイル（readme.txt）
- 各ファイルにサイズと更新日時を表示

## インタラクション

- ドラッグ&ドロップのアニメーション
- チェックボックスの選択で「選択を削除」「ZIPダウンロード」ボタンを有効化
- ファイルカードのホバーで影を表示
- グリッド/リスト表示の切り替えアニメーション
- サイドパネルのスライドイン/アウト

Tailwind CSS、shadcn/ui、Lucide Iconsを使用して、実際に動作するインタラクティブなReactコンポーネントを作成してください。ドラッグ&ドロップでファイルの順番を変更できる機能を実装し、全体的に洗練された日本語のファイル管理アプリケーションのUIにしてください。
```

## リポジトリ構築

### 1. モックをダウンロード

v0.dev からモックをダウンロードし、必要なファイルを作成する。

```sh
touch README.md
pnpm install

git init
git add -A
git commit -m "first commit"

git remote add origin git@github.com:dhythm/file-manager.git
git branch -M main
git push -u origin main
```

### 2. Serena の導入

Serena はコーディングエージェントと、プロジェクトコードの仲介者として働く MCP サーバ。  
参考: https://note.com/kyutaro15/n/n61a8825fe303

1. MCP の追加:

```sh
claude mcp add serena -- uvx --from git+https://github.com/oraios/serena serena start-mcp-server --context ide-assistant --project $(pwd)
```

2. Serena のセットアップ:

Claude を起動して、以下のコマンドを実行。

```sh
/mcp__serena__initial_instructions
```

### 3. CLAUDE.md の作成

```sh
/init in Japanese
```

### 4. linter/formatter の導入

**プロンプト**:
```
linter/formatter を導入したいです。
何パターンか選択肢を提示してください。
それぞれのメリット・デメリットも紹介してください。
```

`.claude/settings.json` に hooks を追加することで、ファイル追加・更新時に実行させる。

### 5. Unit testing の導入

**プロンプト**:
```
vitest の実行環境を構築してください。
```


## 機能開発

Claude Code に指示を出して機能を開発する。

### 仕様駆動開発 (Spec Driven Development)

ここでは、spec-driven development に従い実装する。  
（カスタムコマンド `/spec-driven` を使用）

```sh
/spec-driven
```

#### 1. 事前準備フェーズ

**プロンプト**:
```
リネームしたファイルをZIPで一括ダウンロードするための機能を作成します。
```

#### 2. 要件フェーズ

`requirements.md` を確認し、問題なければ承認を、修正が必要な場合はフィードバックする。

#### 3. 設計フェーズ

`design.md` を確認し、問題なければ承認を、修正が必要な場合はフィードバックする。

#### 4. 実装計画フェーズ

`implementation-plan.md` を確認し、問題なければ承認を、修正が必要な場合はフィードバックする。

#### 5. 実装フェーズ

Phase.1-4 の計画に従い、実装する。

### 実装の仕上げ

完璧に仕上がることは少ない。
そのため、ラストワンマイルは、個別にプロンプトを与えて修正したり、直接修正してしまう方が早い。

#### 問題1: ダウンロードした画像がプレビューの内容と異なる

**プロンプト**:
```
プレビューされている画像と、zip ダウンロードされた画像が別物です。
```

#### 問題2: 「ファイルを選択」ボタンの挙動が想像しにくい
#### 問題3: 「選択を削除」ボタンの挙動が想像しにくい
#### 問題4: 「全てを選択」のテキストをクリックしてもチェックされない

**プロンプト**:
```
「ファイルを選択」ボタンはわかりにくいので、「ファイルをアップロード」に変更してください。
また、「全てを選択」をクリックしてもチェックボックスが発火するようにしてください。（現在はチェックボックスをクリックする必要がある）
選択を削除、をファイルを削除に変更してください。
```

#### 問題5: 更新日時が日付のみ表示となっている

**プロンプト**:（画像添付）
```
[Image #1]
更新日時が日付のみの表示となっています。JST で時間まで表示してください。
また、フォーマットは yyyy/mm/dd hh:mm:ss の形でお願いします。
```

#### 問題6: 昇順/降順が選べない

**プロンプト**:
```
昇順、降順を選択できるようにしてください。
```

### 機能改善

#### 改善1: prefix なしの設定と、連番の桁数設定

**プロンプト**:
```
prefix なしの数字連番のみが設定可能にしてください。
また、数字の桁数を選択可能にしてください。
例として、01.png, 02.png, ... / 001.png, 002.png, ... のような形です。

リネームパターンは連番/日付追加/プレフィックス/サフィックスから選択ではなく、
連番のみ/日付/プレフィックス/サフィックスの選択で、かつ数字桁数と区切り文字（日付・プレフィックス・サフィックスと数字の間の文字、デフォルトは _）を設定可能としてください。
```

## Claude Code 利用時の Tips

1. 実装を依頼するときは「Plan mode」で計画を立てさせてから実行する
2. 作業が終わると、`/clear` でセッションをリセットする
3. 定期的に `/init` で `CLAUDE.md` を更新する

## アプリケーションの実行

```sh
pnpm install

pnpm run dev
```
